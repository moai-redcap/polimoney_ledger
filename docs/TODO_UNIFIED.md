# Polimoney Ledger - 統合 TODO リスト

> **最終更新**: 2025-12-14
>
> このファイルは、プライバシーポリシー、SERVICE_POLICY.md、ARCHITECTURE.md 等から抽出したタスクを統合したものです。

---

## 🔴 最優先（プライバシーポリシー遵守）

プライバシーポリシーに記載されているが、未実装のもの。

| #   | タスク                  | 状態      | 詳細                                       |
| --- | ----------------------- | --------- | ------------------------------------------ |
| P-1 | ポリシー変更通知機能    | ✅ 完了   | フェーズ 1: バナー表示実装済み             |
| P-2 | 画像エクスポート（ZIP） | 🔲 未着手 | 領収書画像も含めた完全なデータエクスポート |
| P-3 | お問い合わせフォーム    | ✅ 完了   | Google Form で設置済み                     |

### P-1: ポリシー変更通知機能 ✅

**実装済み (フェーズ 1):**

- `islands/PolicyBanner.tsx` でバナー表示
- ローカルストレージでユーザー確認済みバージョンを管理
- `CURRENT_POLICY_VERSION` を更新するとバナーが再表示される

**将来の拡張 (フェーズ 2-3):**

- DB でバージョン管理、ユーザー確認記録
- メール通知（重要な変更時）

### P-2: 画像エクスポート（ZIP）

**要件:**

- `/api/export` に `?include_media=true` オプション追加
- 領収書画像を ZIP 形式でダウンロード
- JSON + 画像をまとめた完全エクスポート

### P-3: お問い合わせフォーム ✅

**設置済み:** [Polimoney 総合お問い合わせ窓口](https://docs.google.com/forms/d/e/1FAIpQLSdJ2h2SHLGBtzNbl8NvQ9CZPl0No3PyrPxk4QUGCEx1EB8J6Q/viewform)

- プライバシーポリシー 7 節・12 節にリンク追加済み

---

## 🟠 高優先（MVP 完成）

SERVICE_POLICY.md Phase 1 に該当。

| #   | タスク             | 状態      | 詳細                                   |
| --- | ------------------ | --------- | -------------------------------------- |
| M-1 | Hub 同期: 自動同期 | ✅ 完了   | POST /api/journals/:id/approve で実装  |
| M-2 | 領収証添付機能     | ✅ 完了   | API + ReceiptUploader コンポーネント   |
| M-3 | 仕訳承認画面       | 🔲 未着手 | ApproveJournalScreen                   |
| M-4 | 収支報告書出力     | 🔲 未着手 | PDF/Excel 出力（選挙種別で様式異なる） |

---

## 🟡 中優先（Phase 2-3）

| #   | タスク                 | 状態      | 詳細                         |
| --- | ---------------------- | --------- | ---------------------------- |
| S-1 | 年度締め機能           | 🔲 未着手 | UI + closed ステータス遷移   |
| S-2 | ロック/アーカイブ機能  | 🔲 未着手 | locked ステータス + 画像移行 |
| S-3 | ロック解除リクエスト   | 🔲 未着手 | Hub Admin への依頼 UI        |
| S-4 | 台帳設定・メンバー管理 | 🔲 未着手 | LedgerSettingsScreen         |
| S-5 | 複合仕訳対応           | 🔲 未着手 | 複数行の支払元               |

---

## 🟢 低優先（Phase 4+）

| #   | タスク               | 状態      | 詳細                 |
| --- | -------------------- | --------- | -------------------- |
| L-1 | マネーフォワード連携 | 🔲 未着手 | OAuth2 + 明細取得    |
| L-2 | CSV インポート       | 🔲 未着手 | transaction_drafts   |
| L-3 | Freee 連携           | 🔲 未着手 | OAuth2 + 明細取得    |
| L-4 | AI 科目推奨          | 🔲 未着手 | 摘要からの推論       |
| L-5 | パスワードリセット   | 🔲 未着手 | OTP 方式             |
| L-6 | deprecated API 修正  | 🔲 未着手 | Flutter 3.33.0+ 対応 |

---

## ✅ 完了済み

| #   | タスク                     | 完了日     |
| --- | -------------------------- | ---------- |
| ✓   | データエクスポート (JSON)  | 2025-12-14 |
| ✓   | プライバシーポリシー MD 化 | 2025-12-14 |
| ✓   | Hub 同期 API 実装          | 2024-12-14 |
| ✓   | 関係者マスタ管理画面       | -          |
| ✓   | 登録申請 → Hub 連携        | 2025-12-xx |
| ✓   | 証明書アップロード         | 2025-12-xx |

---

## 📋 Hub 側タスク（参照）

Ledger と連携するが、Hub 側で実装が必要なもの。

| タスク               | Hub 側  | Ledger 側         |
| -------------------- | ------- | ----------------- |
| unlock_requests 処理 | 承認 UI | リクエスト送信 UI |
| 画像ストレージ移行   | 受信    | 送信              |
| 登録申請承認フロー   | ✅ 済   | ✅ 済             |

---

## 方針メモ

### お問い合わせ対応

プライバシーポリシー 7 節・12 節で「お問い合わせフォームよりご連絡ください」と記載。

**暫定対応:**

1. GitHub Issue で公開対応
2. プライバシー関連は `privacy@dd2030.org` 等のメールアドレスを設置

**ポリシー修正案:**

```markdown
## 12. お問い合わせ

本ポリシーに関するお問い合わせは、以下までご連絡ください。

- **GitHub Issue**: [polimoney_ledger](https://github.com/digitaldemocracy2030/polimoney_ledger/issues)
- **Email**: privacy@dd2030.org（プライバシー関連）
```

### 通知機能の段階的実装

| フェーズ | 実装内容                              |
| -------- | ------------------------------------- |
| 1        | バナー表示（手動更新、DB 不要）       |
| 2        | DB でバージョン管理、ユーザー確認記録 |
| 3        | メール通知（重要な変更時）            |

---

## 更新履歴

- 2025-12-14: 初版作成（プライバシーポリシー・SERVICE_POLICY.md から統合）
