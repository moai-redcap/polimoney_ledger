# polimoney_ledger 設計方針書

## 1. バックエンド
- **Supabase**を使用する。
- 各利用者が自身のSupabaseアカウントとプロジェクトを契約して使用する（マルチテナント）。
- **利点:** SQLスクリリプトの実行による、簡単で確実な初回セットアップが可能。

## 2. プロジェクト設定
- 利用者はFlutterアプリ内で、自身のSupabaseプロジェクトの`URL`と`Anon Key`を入力する。

## 3. 初回セットアップ
- **方針:** アプリによる自動チェックは行わない。利用者が提供されたSQLスクリプトを実行することを信頼する。
- **ユーザーマニュアル:** 利用者は、別途用意されたマニュアルに従い、自身のSupabaseプロジェクトのSQL Editorで、提供されたSQLスクリプトを一度だけコピペして実行する。
- **SQLスクリプトの役割:** アプリケーションに必要なテーブル、ロール、そして行レベルセキュリティ(RLS)ポリシーを全て自動で構築する。
- **アプリの役割:** `URL`と`Anon Key`が入力されたら、セットアップが完了しているものとみなし、直接ログイン/サインアップ画面へ進む。設定ミスによるエラーは、APIの応答結果としてユーザーにフィードバックされる。

## 4. 権限管理
- **マスターアカウント:** セットアップ後に最初に作成されたアカウントに、カスタムクレーム等を用いて「マスターアカウント」としての特別な権限を付与する。
- **マスターアカウントの譲渡:** クライアント側のロジックで、2段階承認フローを実装する。権限の状態管理には、専用のテーブルを使用する。

## 5. ディレクトリ構成
- `lib`フォルダ内は、機能ベースのディレクトリ構成（`features/auth`, `core/services`など）を採用する。
