# polimoney_ledger 設計方針書

## 1. バックエンド
- Appwrite Cloudを使用する。
- 各利用者が自身のAppwriteアカウントとプロジェクトを契約して使用する（マルチテナント）。

## 2. プロジェクト設定
- 利用者はFlutterアプリ内で、自身のAppwriteプロジェクトの`Endpoint`と`Project ID`を入力する。

## 3. 初回セットアップ
- アプリが初めてAppwriteプロジェクトに接続する際、「初回セットアップウィザード」を起動する。
- ウィザードは利用者に、特定の権限 (`databases.write`, `teams.write`) を持つAPIキーを一時的に作成・入力するようガイドする。
- アプリはそのAPIキーを一度だけ使用して、必要なDBコレクションやチーム（例: `super-admin`チーム）を自動で作成する。
- セットアップ完了後、APIキーは即座に破棄され、アプリ内には保存されない。利用にはAPIキーを削除するよう案内する。

## 4. 権限管理
- **マスターアカウント:** セットアップ後に最初に作成されたアカウントを、`super-admin`チームの`owner`ロールに割り当てることで、「マスターアカウント」として扱う。
- **マスターアカウントの譲渡:** Appwrite Functionsは使用しない。クライアント側のロジックで、2段階承認（リクエスト→承認）フローを実装する。譲渡の状態管理には専用のDBコレクションを使用する。

## 5. ディレクトリ構成
- `lib`フォルダ内は、機能ベースのディレクトリ構成（`features/auth`, `core/services`など）を採用する。
